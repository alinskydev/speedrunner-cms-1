/* Ephox advanced code plugin
 *
 * Copyright 2010-2016 Ephox Corporation.  All rights reserved.
 *
 * Version: 1.0.2-38
 */

!function(){var a={},b=function(b){for(var c=a[b],e=c.deps,f=c.defn,g=e.length,h=new Array(g),i=0;i<g;++i)h[i]=d(e[i]);var j=f.apply(null,h);if(void 0===j)throw"module ["+b+"] returned undefined";c.instance=j},c=function(b,c,d){if("string"!=typeof b)throw"module id must be a string";if(void 0===c)throw"no dependencies for "+b;if(void 0===d)throw"no definition function for "+b;a[b]={deps:c,defn:d,instance:void 0}},d=function(c){var d=a[c];if(void 0===d)throw"module ["+c+"] was undefined";return void 0===d.instance&&b(c),d.instance},e=function(a,b){for(var c=a.length,e=new Array(c),f=0;f<c;++f)e.push(d(a[f]));b.apply(null,b)},f={};f.bolt={module:{api:{define:c,require:e,demand:d}}};var g=c,h=function(a,b){g(a,[],function(){return b})};h("1",tinymce.PluginManager),h("5",tinymce),h("d",tinymce.util.Tools),h("g",document),g("b",["5","d","g"],function(a,b,c){var d={},e="codeMirrorLazyLoader",f=function(a,c,e){var f=e();b.each(d[a].callbacks,function(a){a(f)}),d[a]={module:f,callbacks:null}},g=function(b,g,h){var i=c.createElement("script");a[e]={define:f},d[b]={module:null,callbacks:[h]},i.src=g,c.body.appendChild(i)},h=function(a,b){var c=d[a];null===c.module?c.callbacks.push(b):b(c.module)},i=function(a,b,c){a in d?h(a,c):g(a,b,c)};return{load:i}}),h("8",tinymce.DOM),h("c",setTimeout),g("e",[],function(){function a(a,b){return function(){a.apply(b,arguments)}}function b(b){if("object"!=typeof this)throw new TypeError("Promises must be constructed via new");if("function"!=typeof b)throw new TypeError("not a function");this._state=null,this._value=null,this._deferreds=[],h(b,a(d,this),a(e,this))}function c(a){var b=this;return null===this._state?void this._deferreds.push(a):void i(function(){var c=b._state?a.onFulfilled:a.onRejected;if(null===c)return void(b._state?a.resolve:a.reject)(b._value);var d;try{d=c(b._value)}catch(b){return void a.reject(b)}a.resolve(d)})}function d(b){try{if(b===this)throw new TypeError("A promise cannot be resolved with itself.");if(b&&("object"==typeof b||"function"==typeof b)){var c=b.then;if("function"==typeof c)return void h(a(c,b),a(d,this),a(e,this))}this._state=!0,this._value=b,f.call(this)}catch(a){e.call(this,a)}}function e(a){this._state=!1,this._value=a,f.call(this)}function f(){for(var a=0,b=this._deferreds.length;a<b;a++)c.call(this,this._deferreds[a]);this._deferreds=null}function g(a,b,c,d){this.onFulfilled="function"==typeof a?a:null,this.onRejected="function"==typeof b?b:null,this.resolve=c,this.reject=d}function h(a,b,c){var d=!1;try{a(function(a){d||(d=!0,b(a))},function(a){d||(d=!0,c(a))})}catch(a){if(d)return;d=!0,c(a)}}if(window.Promise)return window.Promise;var i=b.immediateFn||"function"==typeof setImmediate&&setImmediate||function(a){setTimeout(a,1)},j=Array.isArray||function(a){return"[object Array]"===Object.prototype.toString.call(a)};return b.prototype.catch=function(a){return this.then(null,a)},b.prototype.then=function(a,d){var e=this;return new b(function(b,f){c.call(e,new g(a,d,b,f))})},b.all=function(){var a=Array.prototype.slice.call(1===arguments.length&&j(arguments[0])?arguments[0]:arguments);return new b(function(b,c){function d(f,g){try{if(g&&("object"==typeof g||"function"==typeof g)){var h=g.then;if("function"==typeof h)return void h.call(g,function(a){d(f,a)},c)}a[f]=g,0===--e&&b(a)}catch(a){c(a)}}if(0===a.length)return b([]);for(var e=a.length,f=0;f<a.length;f++)d(f,a[f])})},b.resolve=function(a){return a&&"object"==typeof a&&a.constructor===b?a:new b(function(b){b(a)})},b.reject=function(a){return new b(function(b,c){c(a)})},b.race=function(a){return new b(function(b,c){for(var d=0,e=a.length;d<e;d++)a[d].then(b,c)})},b}),g("6",["b","8","c","d","e"],function(a,b,c,d,e){var f=function(a){var b;return b={lineWrapping:a.codemirror_linewrapping,lineNumbers:a.codemirror_linenumbers,foldGutter:a.codemirror_foldgutter,theme:a.codemirror_theme},a.codemirror_gutter===!1&&(b.gutters=[]),b},g=function(a,f,g,h){return new e(function(e){var i;i=d.extend({lineWrapping:!0,lineNumbers:!0,foldGutter:!0,matchTags:{bothTags:!0},keyMap:"sublime",gutters:["CodeMirror-linenumbers","CodeMirror-foldgutter"],extraKeys:{"Alt-F":"findPersistent","Ctrl-J":"toMatchingTag","Ctrl-B":"selectNextOccurrence","Ctrl-Q":function(a){a.foldCode(a.getCursor())}}},g,{value:h,mode:"text/html"});var j=a(function(a){f.appendChild(a)},i);b.bind(f,"keyup keydown keypress",function(a){27!==a.keyCode&&a.stopPropagation()}),c(function(){j&&(j.refresh(),j.focus())},100),e(j)})},h=function(c,d,f,h,i){return new e(function(e){b.styleSheetLoader.load(d),a.load("ephox.wrap.CodeMirror",c,function(a){g(a,f,i,h).then(e)})})};return{renderTo:h,fromTinySettings:f}}),h("f",tinymce.ui.Throbber),g("7",["f"],function(a){var b=function(a){a.statusbar.items().disabled(!1)},c=function(c,d){c.windowManager.open({title:d.title,body:d.body,buttons:[{text:"Ok",subtype:"primary",onclick:"submit",disabled:!0},{text:"Cancel",onclick:"close"}],onPostRender:function(){var c,e,f=this.getRoot();e=f.find("form > *")[0],c=new a(f.getEl("body")),c.show(1e3),d.onPostRender(e).then(function(){c.hide(),b(f)})},onSubmit:function(a){d.onSubmit(a.data)}})};return{show:c}}),g("2",["6","7","8"],function(a,b,c){var d=function(a,b){var c=a.codemirror_script;return c?c:b+"/codemirror.min.js"},e=function(a,b){var c=a.codemirror_css;return c?c:b+"/codemirror.min.css"},f=function(f,g){var h,i=function(b){var c,i,j,k;return j=d(f.settings,g),k=e(f.settings,g),c=b.getEl("body"),i=f.getContent({source_view:!0}),a.renderTo(j,k,c,i,a.fromTinySettings(f.settings)).then(function(a){h=a})},j=function(){f.focus(),f.undoManager.transact(function(){f.setContent(h.getValue())}),f.selection.setCursorLocation(),f.nodeChanged()};b.show(f,{title:"Source code",body:{type:"panel",border:1,classes:"codemirror",minWidth:f.getParam("code_dialog_width",600),minHeight:f.getParam("code_dialog_height",Math.min(c.getViewPort().h-200,500))},onPostRender:i,onSubmit:j})};return{show:f}}),g("9",[],function(){var a=0,b=1,c=-1,d=function(a){return parseInt(a,10)},e=function(a){return function(){return a}},f=function(a,b,c){return{major:e(a),minor:e(b),patch:e(c)}},g=function(a){var b=/([0-9]+)\.([0-9]+)\.([0-9]+)(?:(\-.+)?)/.exec(a);return b?f(d(b[1]),d(b[2]),d(b[3])):f(0,0,0)},h=function(d,e){var f=d-e;return 0===f?a:f>0?b:c},i=function(b,c){var d=h(b.major(),c.major());if(d!==a)return d;var e=h(b.minor(),c.minor());if(e!==a)return e;var f=h(b.patch(),c.patch());return f!==a?f:a};return{nu:f,parse:g,compare:i}}),g("3",["9"],function(a){var b=function(a){var b=[a.majorVersion,a.minorVersion].join(".");return b.split(".").slice(0,3).join(".")},c=function(c){return c?a.parse(b(c)):null},d=function(b,d){return a.compare(c(b),a.parse(d))<0};return{getVersion:c,isLessThan:d}}),h("a",window),g("4",["a"],function(a){var b=function(a,b){return function(){var c=a.console;c&&b in c&&c[b].apply(c,arguments)}};return{log:b(a,"log"),error:b(a,"error"),warn:b(a,"warm")}}),g("0",["1","2","3","4","5"],function(a,b,c,d,e){var f=function(a,c){return function(){b.show(a,c)}},g=function(a,b){return c.isLessThan(e,"4.3.13")?(d.error("The advcode plugin requires at least 4.3.13 version of TinyMCE."),function(){}):(a.addCommand("mceCodeEditor",f(a,b)),a.addButton("code",{icon:"code",tooltip:"Source code",onclick:f(a,b)}),a.addMenuItem("code",{icon:"code",text:"Source code",context:"tools",onclick:f(a,b)}),{})};return a.add("advcode",g),function(){}}),d("0")()}();